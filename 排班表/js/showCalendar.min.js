// var datelist = new Date();  // 獲取當前系統時間
// var d2 = new Date(2016, 2, 15);    //直接取得
// datelist.getFullYear();     // 獲取年資訊
// datelist.getMonth();        // 獲取月資訊（從0開始 範圍：0-11）
// datelist.getDate();         // 獲取天資訊
// datelist.getDay();          // 獲取星期資訊 （0-6） 

(function() {
    //用於紀錄日期 顯示dateObj中的日期
    var dateObj = (function() {
        var datelist = new Date();
        return {
            getDate: function() {
                return datelist;
            },
            setDate: function(date) {
                datelist = date;
            }
        }
    })();
    //設定calendar div
    renderHtml();
    //表格顯示日期
    showCalendarData();
    //事件
    bindEvent();
    //查詢事件
    SreachCalendar();

    function renderHtml() {
        var calendar = document.getElementById("calendar");
        var titleBox = document.createElement("div"); //上月 下月
        var bodyBox = document.createElement("div"); //表格區

        titleBox.className = 'calendar-title-box';
        titleBox.innerHTML =
            "<span class='prev-month' id='prevMonth'></span>" +
            "<span class='next-month' id='nextMonth'></span>";
        calendar.appendChild(titleBox); //新增至calendar中

        //設定表格結構
        titleBox.className = 'calendar-title-box';

        var headHtml =
            "<tr style='height:0px'>" +
            "<th style='color:red'>Sunday</th>" +
            "<th>Monday</th>" +
            "<th>Tuesday</th>" +
            "<th>Wednesday</th>" +
            "<th>Thursday</th>" +
            "<th>Friday</th>" +
            "<th style='color:red'>Saturday</th>" +
            "</tr>";
        var bodyHtml = "";
        bodyBox.className = 'calendar-body-box';
        for (var i = 0; i < 6; i++) {
            bodyHtml +=
                "<tr>" +
                "<td></td>" +
                "<td></td>" +
                "<td></td>" +
                "<td></td>" +
                "<td></td>" +
                "<td></td>" +
                "<td></td>" +
                "</tr>";
        }
        bodyBox.innerHTML = "<table id='calendarTable' class='calendar-table'>" +
            headHtml +
            bodyHtml + "</table>";
        calendar.appendChild(bodyBox);
    }

    //顯示表格資料
    function showCalendarData() {
        var year = dateObj.getDate().getFullYear();
        var month = dateObj.getDate().getMonth();
        var day = getDateStr(dateObj.getDate());

        //頂部年月資訊
        var calendarTitle = document.getElementById("calendarTitle");
        var titleStr = day.substr(0, 4) + "年" + day.substr(4, 2) + "月";
        calendarTitle.innerHTML = titleStr;

        //表格中日期資料
        var table = document.getElementById("calendarTable");
        var tds = table.getElementsByTagName("td"); //6格
        var firstDay = new Date(year, month, 1); // 當月第一天

        for (var i = 0; i < tds.length; i++) {
            var thisDay = new Date(year, month, i + 1 - firstDay.getDay());
            var thisDayStr = getDateStr(thisDay);
            tds[i].innerText = thisDay.getDate();
            tds[i].setAttribute('data', thisDayStr);
            //var test = getDateStr(new Date());
            //console.log(test);
            //console.log(thisDayStr);
            if (thisDayStr == getDateStr(new Date())) { //當前天
                tds[i].className = 'currentDay';
            } else if (thisDayStr.substr(0, 6) == getDateStr(firstDay).substr(0, 6)) {
                tds[i].className = 'currentMonth'; //當前月份
            } else { //其他月份
                tds[i].className = 'otherMonth';
            }
        }
    }

    function SreachCalendar() {
        var Sreach = document.getElementById("sreach");
        Sreach.addEventListener("click",function(){
            goMonth();
        });
    }

    function goMonth() {
        var Arr = new Array;
        var Sdate = document.getElementById("Sdate").value;
        Arr = Sdate.split("-");

        var sy = Arr[0];
        var sm = Arr[1] - 1;
        var sd = Arr[2];

        console.log(sy);
        console.log(sm);

        dateObj.setDate(new Date(sy, sm, sd));

        showCalendarData();
    }

    //連結上月 下月事件
    function bindEvent() {
        var prevMonth = document.getElementById("prevMonth");
        var nextMonth = document.getElementById("nextMonth");
        prevMonth.addEventListener("click", function() {
            toPrevMonth();
        });
        nextMonth.addEventListener("click", function() {
            toNextMonth();
        })
    }

    //上月
    function toPrevMonth() {
        var date = dateObj.getDate();
        dateObj.setDate(new Date(date.getFullYear(), date.getMonth() - 1, 1));
        showCalendarData();
    }
    //下月
    function toNextMonth() {
        var date = dateObj.getDate();
        dateObj.setDate(new Date(date.getFullYear(), date.getMonth() + 1, 1));
        showCalendarData();
    }

    function getDateStr(date) {
        var year = date.getFullYear();
        var month = date.getMonth() + 1; //校正
        var d = date.getDate();

        month = (month > 9) ? ("" + month) : ("0" + month); //若月份小於9就在前方加0
        d = (d > 9) ? ("" + d) : ("0" + d) //若天數小於9就在前方加0
        return year + month + d;
    }
})();